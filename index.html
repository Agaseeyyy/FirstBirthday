<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="image" property="og:image" content="https://png.pngtree.com/png-clipart/20220923/original/pngtree-cute-happy-birthday-to-you-my-love-banner-with-balloons-png-image_8629345.png">
  <meta name="description" content="A birthday cake and message for my love.">
  <title>Love's Birthday</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#FEF5F7',
              100: '#FDEBEF',
              200: '#FADCE3',
              300: '#F6C8D3',
              400: '#F0A3B8',
              500: '#E97D9C',
              600: '#D35A7D',
              700: '#B33F61',
              800: '#8F294C',
              900: '#72193B',
            },
            chocolate: {
              100: '#F7F0E6',
              200: '#E9D8C0',
              300: '#D9BC94',
              400: '#C8A06B',
              500: '#B78246',
              600: '#96682F',
              700: '#775027',
              800: '#5A3C20',
              900: '#402C19',
            }
          },
          fontFamily: {
            'fancy': ['Pacifico', 'cursive'],
            'sans': ['Poppins', 'system-ui', 'sans-serif'],
          },
          animation: {
            'float-mobile': 'float-mobile 8s ease-in-out infinite',
            'confetti-fall-mobile': 'confetti-fall-mobile 2s forwards',
            'float': 'float 6s ease-in-out infinite',
            'spin-slow': 'spin 8s linear infinite',
            'bounce-slow': 'bounce 2s infinite',
            'pulse-slow': 'pulse 3s infinite',
            'ping-slow': 'ping 3s cubic-bezier(0, 0, 0.2, 1) infinite',
            'flame-blow': 'flame-blow 0.5s ease-in-out infinite',
          },
          boxShadow: {
            'candy': '0 5px 15px rgba(247, 103, 180, 0.3)',
            'neon': '0 0 5px theme("colors.primary.400"), 0 0 20px theme("colors.primary.300")',
          },
          backgroundImage: {
            'confetti-pattern': "url(\"data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23f7bfd3' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E\")",
          },
          keyframes: {
            'float-mobile': {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-5px)' },
            },
            'confetti-fall-mobile': {
              '0%': { transform: 'translateY(-100vh)', opacity: '1' },
              '100%': { transform: 'translateY(100vh)', opacity: '0' },
            },
            'flame-blow': {
              '0%': { 
                transform: 'scale(1) rotate(-2deg) translateX(0)',
                opacity: '0.9'
              },
              '50%': { 
                transform: 'scale(1.3) rotate(2deg) translateX(5px)',
                opacity: '1',
                filter: 'blur(2px)'
              },
              '100%': { 
                transform: 'scale(1) rotate(-1deg) translateX(0)',
                opacity: '0.9'
              },
            },
          },
        },
        screens: {
          'xs': '480px',
          'sm': '640px',
          'md': '768px',
          'lg': '1024px',
          'xl': '1280px',
        },
        transitionProperty: {
          'transform-opacity': 'transform, opacity',
        },
      },
      variants: {
        extend: {
          display: ['responsive'],
          scale: ['responsive', 'hover', 'focus', 'active'],
        },
      },
    }
  </script>

  <!-- complex CSS components -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  
</head>
<body class="bg-gradient-to-br from-pink-50 to-orange-50 min-h-screen overflow-y-auto relative">
  <div class="fixed inset-0 pointer-events-none bg-confetti-pattern opacity-60"></div>

  <div class="w-full max-w-screen-lg mx-auto py-8 relative z-10 px-4">
    <div 
      x-data="{
        micAccess: false,
        blown: false,
        blowStrength: 0,
        candles: [1, 2, 3, 4, 5],
        audioContext: null,
        analyser: null,
        microphone: null,
        dataArray: null,
        birthdaySongWasPlaying: false,
        songAutoplayFailed: false,
        isMobile: false,
        blowHistory: [],
        consecutiveBlowFrames: 0,
        lowPass: null,
        
        init() {
          this.isMobile = window.innerWidth < 768;
          if (typeof window !== 'undefined' && window.AudioContext) {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
          }
          this.addRandomStars();
          if (!this.isMobile) {
            this.setupFireworks();
            this.addRandomSparkles();
          }
          this.tryPlayBirthdaySong();
        },
        
        addRandomStars() {
          const body = document.querySelector('body');
          const count = this.isMobile ? 5 : 15;
          for (let i = 0; i < count; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = `${Math.random() * 95}vw`;
            star.style.top = `${Math.random() * 95}vh`;
            star.style.transform = `rotate(${Math.random() * 180}deg) scale(${Math.random() * 0.5 + 0.3})`;
            star.style.opacity = Math.random() * 0.5 + 0.3;
            star.style.animationDelay = `${Math.random() * 2}s`;
            body.appendChild(star);
          }
        },
        
        tryPlayBirthdaySong() {
          const birthdaySong = this.$refs.birthdaySong;
          if (birthdaySong) {
            birthdaySong.volume = 0.7;
            
            birthdaySong.play()
              .then(() => {
                console.log('Birthday song autoplay successful');
                this.songAutoplayFailed = false;
              })
              .catch(error => {
                console.log('Autoplay prevented by browser', error);
                this.songAutoplayFailed = true;
                this.showPlaySongButton();
                
                // Try again on user interaction
                const playOnInteraction = () => {
                  if (this.songAutoplayFailed) {
                    birthdaySong.play().catch(e => console.log('Still could not play', e));
                  }
                  document.removeEventListener('click', playOnInteraction);
                  document.removeEventListener('touchstart', playOnInteraction);
                };
                document.addEventListener('click', playOnInteraction, { once: true });
                document.addEventListener('touchstart', playOnInteraction, { once: true });
              });
          }
        },
        
        showPlaySongButton() {
          const container = document.querySelector('body');
          if (!container) return;
          
          const button = document.createElement('button');
          
          // Improved class with better mobile positioning and tap area
          button.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-primary-500 hover:bg-primary-600 text-white py-3 px-4 rounded-xl shadow-xl z-[100] flex items-center justify-center md:bottom-auto md:left-auto md:transform-none md:top-4 md:right-4 md:rounded-full md:py-2 md:px-3';
          
          // Simplified SVG with better size for touch
          button.innerHTML = `
            <svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 md:h-6 md:w-6' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
              <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3' />
            </svg>
            <span class='ml-2 text-base font-medium md:text-sm'>Play Music</span>
          `;
          
          // Add both click and touchend handlers for better mobile response
          const playMusic = () => {
            const birthdaySong = this.$refs.birthdaySong;
            if (birthdaySong) {
              birthdaySong.play()
                .then(() => {
                  button.classList.add('opacity-0');
                  setTimeout(() => button.remove(), 300); // Remove after fade-out
                })
                .catch(err => {
                  console.error('Failed to play:', err);
                  // Make the button pulse to indicate it needs to be tapped again
                  button.classList.add('animate-pulse');
                });
            }
          };
          
          button.addEventListener('click', playMusic);
          button.addEventListener('touchend', (e) => {
            e.preventDefault(); // Prevent double-firing with click
            playMusic();
          });
          
          // Add transition for smooth hiding
          button.style.transition = 'opacity 0.3s ease';
          
          container.appendChild(button);
        },
        
        requestMicAccess() {
          if (!this.audioContext) {
            alert('Your browser does not support the Web Audio API');
            return;
          }
          
          navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
              this.micAccess = true;
              this.setupAudioAnalysis(stream);
            })
            .catch(err => {
              console.error('Error accessing microphone:', err);
              alert('Could not access your microphone. Please check your permissions.');
            });
        },
        
        setupAudioAnalysis(stream) {
          // First resume the audio context if it's suspended
          if (this.audioContext.state === 'suspended') {
            this.audioContext.resume().then(() => {
              console.log('AudioContext resumed successfully');
            });
          }
    
          this.microphone = this.audioContext.createMediaStreamSource(stream);
          this.analyser = this.audioContext.createAnalyser();
          this.analyser.fftSize = 256;
          this.analyser.smoothingTimeConstant = 0.8; // Add smoothing for more stable readings
          
          this.microphone.connect(this.analyser);
          
          const bufferLength = this.analyser.frequencyBinCount;
          this.dataArray = new Uint8Array(bufferLength);
          
          this.startListening();
        },
        
        startListening() {
          const detectBlow = () => {
            if (!this.blown) {
              this.analyser.getByteFrequencyData(this.dataArray);
              
              // Calculate both total volume and low frequency volume
              let totalSum = 0;
              let lowFreqSum = 0;
              let count = 0;
              
              // Analyze the full spectrum but weight lower frequencies more
              for (let i = 0; i < this.dataArray.length; i++) {
                totalSum += this.dataArray[i];
                
                // Extra weight for lower frequencies (blowing sounds)
                if (i < this.dataArray.length / 3) {
                  lowFreqSum += this.dataArray[i] * 2.5;
                }
                count++;
              }
              
              const avgTotal = totalSum / count;
              const avgLowFreq = lowFreqSum / (count * 2.5);
              
              // Combine both metrics with more weight on low frequencies
              const combinedStrength = (avgLowFreq * 0.7) + (avgTotal * 0.3);
              
              // More sensitive normalization
              const normalizedStrength = Math.min(1, combinedStrength / 60); // Reduced denominator
              
              // Smoother transitions with exponential averaging
              this.blowStrength = this.blowStrength * 0.6 + normalizedStrength * 0.4;
              
              
              // Lower threshold to 0.85 (85%) and add minimum duration check
              if (this.blowStrength > 0.85) {
                this.candlesBlown();
                return;
              }
              
              requestAnimationFrame(detectBlow);
            }
          };
          
          detectBlow();
        },
        
        updateCandleFlicker(intensity) {
          document.querySelectorAll('.flame').forEach(flame => {
            flame.style.transform = `scale(${1 + intensity * 0.5})`;
            flame.style.animationDuration = `${1 - intensity * 0.5}s`;
            flame.style.opacity = 0.8 + intensity * 0.2;
          });
        },
        
        candlesBlown() {
          if (this.blown) return;
          
          this.blown = true;
          
          document.querySelectorAll('.flame').forEach(flame => {
            // Add final strong blow animation
            flame.classList.remove('flame-blow-light', 'flame-blow-medium');
            flame.classList.add('flame-blow-strong');
            
            // Then fade out after a brief delay
            setTimeout(() => {
              flame.style.opacity = '0';
              flame.style.transform = 'scale(0.5) translateY(-10px) translateX(15px)';
              flame.style.transition = 'all 0.3s ease-out';
              
              // Finally hide
              setTimeout(() => {
                flame.style.display = 'none';
              }, 300);
            }, 200);
          });
          
          // Rest of your existing function...
          const birthdaySong = this.$refs.birthdaySong;
          if (birthdaySong) {
            birthdaySong.volume = 0.7;
            birthdaySong.play().catch(e => console.log('Error playing song', e));
          }
          
          this.createConfetti();
          this.createFirework(5);
        },
        
        createConfetti() {
          const container = document.getElementById('confetti-container');
          if (!container) return;
          
          container.innerHTML = '';
          
          const particleCount = this.isMobile ? 50 : 250;
          const colors = ['#ff5252', '#ffeb3b', '#2196f3', '#4caf50', '#e91e63', '#9c27b0', '#3f51b5', '#00bcd4'];
          const shapes = ['circle', 'square', 'triangle', 'line', 'heart'];
          
          for (let i = 0; i < particleCount; i++) {
            const confetti = document.createElement('div');
            const shape = shapes[Math.floor(Math.random() * shapes.length)];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            confetti.className = 'confetti';
            
            if (shape === 'circle') {
              confetti.style.borderRadius = '50%';
            } else if (shape === 'triangle') {
              confetti.style.width = '0';
              confetti.style.height = '0';
              confetti.style.borderLeft = `${Math.random() * 10 + 5}px solid transparent`;
              confetti.style.borderRight = `${Math.random() * 10 + 5}px solid transparent`;
              confetti.style.borderBottom = `${Math.random() * 15 + 10}px solid ${color}`;
              confetti.style.backgroundColor = 'transparent';
            } else if (shape === 'heart') {
              confetti.innerHTML = '❤';
              confetti.style.fontSize = `${Math.random() * 15 + 10}px`;
              confetti.style.color = color;
              confetti.style.backgroundColor = 'transparent';
            }
            
            Object.assign(confetti.style, {
              position: 'absolute',
              left: `${10 + Math.random() * 80}%`,
              top: `-${Math.random() * 20 + 10}px`,
              width: shape !== 'triangle' && shape !== 'heart' ? `${Math.random() * 10 + 5}px` : '',
              height: shape !== 'triangle' && shape !== 'heart' ? `${Math.random() * 10 + 5}px` : '',
              backgroundColor: shape !== 'triangle' && shape !== 'heart' ? color : 'transparent',
              transform: `rotate(${Math.random() * 360}deg)`,
              animation: `confetti-fall ${Math.random() * 3 + 2}s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards`,
              animationDelay: `${Math.random() * 3}s`,
              opacity: Math.random() * 0.3 + 0.7,
              zIndex: '100'
            });
            
            container.appendChild(confetti);
          }
        },
        
        playBirthdayMessage() {
          const birthdaySong = this.$refs.birthdaySong;
          const birthdayMessage = this.$refs.birthdayMessage;
          
          if (!birthdayMessage) return;
          
          // First, properly track if the birthday song is actually playing
          // Do this BEFORE any other operations
          const isSongCurrentlyPlaying = birthdaySong && !birthdaySong.paused;
          
          // Toggle play/pause if message is already playing
          if (!birthdayMessage.paused) {
            birthdayMessage.pause();
            console.log('Birthday message paused');
            return;
          }
          
          // Store song state ONLY if it's actually playing
          this.birthdaySongWasPlaying = isSongCurrentlyPlaying;
          console.log('Was birthday song playing?', this.birthdaySongWasPlaying);
          
          // Pause birthday song only if it's actively playing
          if (isSongCurrentlyPlaying) {
            console.log('Pausing birthday song to play message');
            birthdaySong.pause();
          }
          
          // Visual feedback for button press
          const button = event.currentTarget;
          button.classList.add('scale-95');
          setTimeout(() => button.classList.remove('scale-95'), 150);
          
          // Play the message
          birthdayMessage.play()
            .then(() => {
              console.log('Birthday message playing');
            })
            .catch(e => {
              console.error('Error playing message:', e);
              // If message fails to play but song was playing, resume it
              if (this.birthdaySongWasPlaying) {
                birthdaySong.play().catch(e => console.log('Error resuming song', e));
              }
            });
          
          // When message ends, resume song ONLY if it was actually playing before
          birthdayMessage.addEventListener('ended', () => {
            console.log('Message ended. Should resume song?', this.birthdaySongWasPlaying);
            if (this.birthdaySongWasPlaying) {
              birthdaySong.play()
                .then(() => console.log('Birthday song resumed after message'))
                .catch(e => console.log('Error resuming song:', e));
            }
          }, { once: true });
        },
        
        setupFireworks() {
          const container = document.getElementById('fireworks-container');
          if (!container) return;
          
          this.createFirework(3);
          
          setInterval(() => {
            if (!this.isMobile || this.blown) {
              this.createFirework(1);
            }
          }, 3000);
        },
        
        createFirework(count) {
          const container = document.getElementById('fireworks-container');
          if (!container) return;
          
          const actualCount = this.isMobile ? Math.min(count, 2) : count;
          const colors = ['#ff5252', '#4dabff', '#4dffb8', '#ffed4d', '#d14dff'];
          
          for (let i = 0; i < actualCount; i++) {
            const x = Math.random() * 100;
            const y = Math.random() * 60 + 10;
            const size = Math.random() * 40 + 60;
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            setTimeout(() => {
              const firework = document.createElement('div');
              firework.className = 'firework';
              firework.style.left = `${x}vw`;
              firework.style.top = `${y}vh`;
              
              const particleCount = this.isMobile ? 8 : 12;
              
              for (let j = 0; j < particleCount; j++) {
                const particle = document.createElement('div');
                const angle = (j / particleCount) * 360;
                particle.style.position = 'absolute';
                particle.style.width = '2px';
                particle.style.height = '10px';
                particle.style.backgroundColor = color;
                particle.style.transformOrigin = 'bottom center';
                particle.style.transform = `rotate(${angle}deg) translate(0, -${size}px)`;
                particle.style.animation = `explode 1.5s ease-out forwards`;
                firework.appendChild(particle);
              }
              
              container.appendChild(firework);
              
              setTimeout(() => container.removeChild(firework), 1500);
            }, Math.random() * 1000 * i);
          }
        },
        
        addRandomSparkles() {
          if (this.isMobile) return;
          
          const body = document.querySelector('body');
          for (let i = 0; i < 10; i++) {
            setTimeout(() => {
              const sparkle = document.createElement('div');
              sparkle.className = 'sparkle';
              sparkle.style.left = `${Math.random() * 90 + 5}vw`;
              sparkle.style.top = `${Math.random() * 90 + 5}vh`;
              sparkle.style.animationDelay = `${Math.random() * 2}s`;
              sparkle.style.transform = `scale(${Math.random() * 0.5 + 0.5})`;
              
              sparkle.innerHTML = `
                <svg viewBox='0 0 24 24'>
                  <path d='M12,0 L14,9 L23,12 L14,15 L12,24 L10,15 L1,12 L10,9 Z' fill='${Math.random() > 0.5 ? 'gold' : '#ffc0cb'}'/>
                </svg>
              `;
              
              body.appendChild(sparkle);
            }, i * 1000);
          }
        }
      }"
      class="w-full mx-auto relative"
      x-init="init()"
    >
      <!-- Background pattern -->
      <div class="festive-pattern"></div>

      <!-- Balloon 1 -->
      <div class="fixed top-10 left-20 transform rotate-6 z-10 origin-bottom md:block hidden" style="animation-delay: 0.5s;">
        <div class="relative w-[50px] h-[65px] rounded-[50%_50%_50%_50%_/_40%_40%_60%_60%] shadow-inner shadow-black/15 bg-gradient-to-br from-yellow-300 to-yellow-500">
          <div class="absolute w-[15px] h-[15px] bg-white/50 rounded-full top-[10px] left-[10px]"></div>
        </div>
        <div class="absolute w-[1px] h-[80px] bg-black/60 -bottom-[80px] left-[25px] origin-top"></div>
      </div>

      <!-- Balloon 2 (visible on all screens) -->
      <div class="fixed top-32 right-12 transform -rotate-3 z-10 origin-bottom" style="animation-delay: 0.3s;">
        <div class="relative w-[50px] h-[65px] rounded-[50%_50%_50%_50%_/_40%_40%_60%_60%] shadow-inner shadow-black/15 bg-gradient-to-br from-green-300 to-green-600">
          <div class="absolute w-[15px] h-[15px] bg-white/50 rounded-full top-[10px] left-[10px]"></div>
        </div>
        <div class="absolute w-[1px] h-[80px] bg-black/60 -bottom-[80px] left-[25px] origin-top"></div>
      </div>

      <!-- More balloons (hidden on mobile) -->
      <div class="fixed top-40 right-80 transform -rotate-5 z-10 origin-bottom lg:block hidden" style="animation-delay: 0.7s;">
        <div class="relative w-[50px] h-[65px] rounded-[50%_50%_50%_50%_/_40%_40%_60%_60%] shadow-inner shadow-black/15 bg-gradient-to-br from-pink-300 to-pink-500">
          <div class="absolute w-[15px] h-[15px] bg-white/50 rounded-full top-[10px] left-[10px]"></div>
        </div>
        <div class="absolute w-[1px] h-[80px] bg-black/60 -bottom-[80px] left-[25px] origin-top"></div>
      </div>

      <div class="balloon-container fixed top-16 left-10 transform rotate-10" style="animation-delay: 2s; z-index: 10;">
        <div class="balloon balloon-purple"></div>
        <div class="balloon-string"></div>
      </div>

      <div class="balloon-container fixed top-20 right-20 transform -rotate-7" style="animation-delay: 1.8s; z-index: 10;">
        <div class="balloon balloon-blue"></div>
        <div class="balloon-string"></div>
      </div>
      
      <!-- Party hat decorations -->
      <div class="party-hat absolute top-10 left-40 rotate-12 animate-bounce-slow">
        <svg width="50" height="70" viewBox="0 0 60 80">
          <path d="M30,0 L60,70 L0,70 Z" fill="url(#party-hat-gradient)" />
          <circle cx="30" cy="70" r="10" fill="#f5d0d0" />
          <defs>
            <linearGradient id="party-hat-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#ff9ed0" />
              <stop offset="100%" stop-color="#d1569a" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      
      <div class="party-hat absolute bottom-40 right-20 -rotate-12 animate-bounce-slow" style="animation-delay: 1.2s">
        <svg width="40" height="60" viewBox="0 0 60 80">
          <path d="M30,0 L60,70 L0,70 Z" fill="url(#party-hat-gradient2)" />
          <circle cx="30" cy="70" r="10" fill="#d0f5e9" />
          <defs>
            <linearGradient id="party-hat-gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#4dffb8" />
              <stop offset="100%" stop-color="#1a9c61" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      
      <!-- Present boxes -->
      <div class="present-box absolute bottom-10 left-10 z-10" style="animation-delay: 0.2s">
        <svg width="50" height="60" viewBox="0 0 60 70">
          <!-- Box -->
          <rect x="5" y="20" width="50" height="50" fill="#4dabff" rx="2" />
          <!-- Lid -->
          <rect x="0" y="15" width="60" height="10" fill="#236bac" rx="2" />
          <!-- Ribbon -->
          <rect x="25" y="0" width="10" height="70" fill="#ff6b6b" />
          <rect x="5" y="35" width="50" height="10" fill="#ff6b6b" />
          <!-- Ribbon knot -->
          <circle cx="30" cy="15" r="7" fill="#ff9e9e" />
        </svg>
      </div>
      
      <div class="present-box absolute bottom-20 right-20 z-10" style="animation-delay: 1.5s">
        <svg width="40" height="50" viewBox="0 0 60 70">
          <!-- Box -->
          <rect x="5" y="20" width="50" height="50" fill="#ffed4d" rx="2" />
          <!-- Lid -->
          <rect x="0" y="15" width="60" height="10" fill="#d1b325" rx="2" />
          <!-- Ribbon -->
          <rect x="25" y="0" width="10" height="70" fill="#d14dff" />
          <rect x="5" y="35" width="50" height="10" fill="#d14dff" />
          <!-- Ribbon knot -->
          <circle cx="30" cy="15" r="7" fill="#e980ff" />
        </svg>
      </div>
      
      <!-- Decoration Number "1" -->
      <div class="decoration-number absolute top-24 right-4 w-16 h-16 z-50">
        <span class="text-3xl">22th</span>
      </div>
      
      <!-- Sparkles -->
      <div class="sparkle absolute top-24 left-32" style="animation-delay: 0.3s">
        <svg viewBox="0 0 24 24">
          <path d="M12,0 L14,9 L23,12 L14,15 L12,24 L10,15 L1,12 L10,9 Z" />
        </svg>
      </div>
      
      <div class="sparkle absolute bottom-32 right-48" style="animation-delay: 1s">
        <svg viewBox="0 0 24 24">
          <path d="M12,0 L14,9 L23,12 L14,15 L12,24 L10,15 L1,12 L10,9 Z" />
        </svg>
      </div>
      
      <div class="sparkle absolute top-48 right-24" style="animation-delay: 1.7s">
        <svg viewBox="0 0 24 24">
          <path d="M12,0 L14,9 L23,12 L14,15 L12,24 L10,15 L1,12 L10,9 Z" />
        </svg>
      </div>
      
      
      <!-- Streamers -->
      <div class="streamer streamer-left absolute -top-5 left-10" 
          style="background: linear-gradient(to bottom, #ff6b6b, #ffa5a5);">
      </div>
      
      <div class="streamer streamer-right absolute -top-5 right-20" 
          style="background: linear-gradient(to bottom, #4dabff, #a5d4ff);">
      </div>
      
      <div class="streamer absolute -top-5 left-1/3" 
          style="background: linear-gradient(to bottom, #ffed4d, #ffe99c); animation-delay: 1.5s">
      </div>
      
      <div class="streamer absolute -top-5 right-1/3" 
          style="background: linear-gradient(to bottom, #4dffb8, #a5ffde); animation-delay: 2s">
      </div>
      
      <!-- Add firework effect container -->
      <div class="fixed inset-0 pointer-events-none z-40 overflow-hidden" id="fireworks-container"></div>
      <div class="fixed inset-0 pointer-events-none z-50 overflow-hidden" id="confetti-container"></div>
      
      <!-- Star decorations (keep those from before) -->
      <div class="star absolute top-20 left-20 scale-75"></div>
      <div class="star absolute bottom-24 right-36 scale-50"></div>
      <div class="star absolute top-40 right-24"></div>
      <div class="star absolute bottom-40 left-32 scale-90"></div>
      
      <!-- Ribbon decoration in corner -->
      <div class="ribbon absolute -top-4 -right-4"></div>
      
      <div 
        class="max-w-md w-full mx-auto relative"
        x-init="init()"
      >
        <div class="relative z-10 transform">
          <!-- Enhanced title with decorative elements -->
          <h1 class="text-5xl font-fancy text-center mb-4 relative">
            <span class="relative inline-block">
              <span class="absolute inset-0 transform rotate-1">
                <span class="absolute inset-0 bg-primary-100 rounded-lg opacity-30 blur-md"></span>
              </span>
              <span class="relative gradient-text drop-shadow-lg min-h-28">Happy Birthday, Yapi!</span>
            
            </span>
          </h1>
        
          <!-- Main cake container with improved design -->
          <div class="relative bg-gradient-to-br from-chocolate-100 to-chocolate-200 p-4 sm:p-6 md:p-10 rounded-2xl shadow-xl border border-chocolate-300 overflow-hidden">
            <!-- Decorative blobs -->
            <div class="absolute -top-10 -left-10 w-28 h-28 bg-primary-200 rounded-full opacity-40 blur-lg"></div>
            <div class="absolute -bottom-8 -right-8 w-24 h-24 bg-primary-200 rounded-full opacity-40 blur-lg"></div>

            
            <div class="flex flex-col items-center">
              <!-- Cake visualization with pop-in animation -->
              <div class="relative mb-8 md:mb-12 mt-4 md:mt-8 transform scale-75 sm:scale-90 md:scale-100" style="animation: pop-in 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;">
                <div class="cake">
                  <div class="plate"></div>
                  <div class="layer layer-bottom"></div>
                  <div class="layer layer-middle"></div>
                  <div class="layer layer-top"></div>
                  <div class="icing"></div>
                  <div class="drip drip1"></div>
                  <div class="drip drip2"></div>
                  <div class="drip drip3"></div>
                  
                  <!-- Generate 30 sprinkles randomly positioned with more vibrant colors -->
                  <template x-for="i in 30">
                    <div class="sprinkle" 
                        :style="`
                          top: ${Math.random() * 80}px; 
                          left: ${Math.random() * 240}px; 
                          transform: rotate(${Math.random() * 180}deg); 
                          background-color: hsl(${Math.random() * 360}, 90%, 65%);
                        `">
                    </div>
                  </template>
                  
                  <!-- Candle group with better positioning -->
                  <div class="candle-group">
                    <template x-for="(candle, index) in candles" :key="index">
                      <div class="candle" :class="{'animate-pulse-slow': !blown}">
                        <div class="flame" x-show="!blown" style="display: none;" x-transition:leave="transition-opacity duration-300" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"></div>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
              
              <!-- Microphone access and improved instructions -->
              <div class="text-center mb-4 sm:mb-6 md:mb-8 bg-white bg-opacity-90 p-3 sm:p-4 md:p-6 rounded-xl shadow-lg border-2 border-chocolate-200 w-full max-w-md mx-auto">
                <template x-if="!micAccess">
                  <button 
                    @click="requestMicAccess" 
                    class="btn-3d bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white font-bold py-4 px-8 rounded-full mb-4 shadow-lg"
                  >
                    <span class="flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                      </svg>
                      Start the Celebration
                    </span>
                  </button>
                </template>
                
                <template x-if="micAccess && !blown">
                  <div class="text-chocolate-800 rounded-lg p-4 bg-chocolate-100 border border-chocolate-300">
                    <p class="mb-2 font-medium">Microphone Ready!</p>
                    <p class="font-bold text-xl mb-4">Blow into your microphone to blow out the candles 🎂</p>
                    
                    <!-- Enhanced blow strength meter -->
                    <div class="mt-3 relative">
                      <div class="h-8 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner">
                        <div 
                          class="h-full bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500 transition-all duration-200 flex items-center justify-end pr-3 text-xs text-white font-bold"
                          :style="`width: ${Math.min(blowStrength * 100, 100)}%`"
                          x-text="Math.round(Math.min(blowStrength * 100, 100)) + '%'"
                        ></div>
                      </div>
                      
                      <!-- Blow strength guidance -->
                      <div class="flex justify-between text-xs text-chocolate-600 mt-1">
                        <span>Gentle</span>
                        <span class="font-medium">Blow Harder</span>
                        <span>Strong!</span>
                      </div>
                    </div>
                  </div>
                </template>
                
                <template x-if="blown">
                  <div class="text-center py-4">
                    <p class="text-3xl font-fancy gradient-text font-bold mb-3 animate-pulse">
                      🎉 Happy Birthday! 🎉
                    </p>
                    <p class="text-chocolate-700">Your wish has been made, Lovee! 🌈</p>
                  </div>
                </template>
              </div>
              
              <!-- Replace the existing birthday message button with this enhanced version -->
              <div class="flex flex-col items-center space-y-4">
                <!-- Improved birthday message button -->
                <button 
                  @click="playBirthdayMessage" 
                  class="btn-3d bg-gradient-to-r from-primary-400 to-primary-600 hover:from-primary-500 hover:to-primary-700 text-white font-bold py-4 px-8 rounded-full shadow-lg flex items-center transform transition-transform duration-300 ease-in-out hover:scale-105"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span class="relative">
                    Play Birthday Message
                    <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                  </span>
                </button>
                
                <!-- Audio controls that show when playing -->
                <div 
                  x-data="{ 
                    isPlaying: false, 
                    currentTime: 0, 
                    duration: 0,
                    volume: 0.7,
                    formatTime(seconds) {
                      const min = Math.floor(seconds / 60);
                      const sec = Math.floor(seconds % 60);
                      return `${min}:${sec < 10 ? '0' + sec : sec}`;
                    },
                    dragSeek(event) {
                      const onMouseMove = (e) => {
                        const rect = event.target.parentElement.getBoundingClientRect();
                        const pos = (e.clientX - rect.left) / rect.width;
                        this.currentTime = this.duration * pos;
                        this.$refs.birthdayMessage.currentTime = this.currentTime;
                      };
                      const onMouseUp = () => {
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                      };
                      document.addEventListener('mousemove', onMouseMove);
                      document.addEventListener('mouseup', onMouseUp);
                    }
                  }"
                  x-init="
                    $refs.birthdayMessage.addEventListener('play', () => isPlaying = true);
                    $refs.birthdayMessage.addEventListener('pause', () => isPlaying = false);
                    $refs.birthdayMessage.addEventListener('ended', () => isPlaying = false);
                    $refs.birthdayMessage.addEventListener('timeupdate', () => currentTime = $refs.birthdayMessage.currentTime);
                    $refs.birthdayMessage.addEventListener('loadedmetadata', () => duration = $refs.birthdayMessage.duration);
                    $refs.birthdayMessage.volume = volume;
                    $refs.birthdaySong.volume = volume;
                  "
                  x-show="isPlaying"
                  x-transition:enter="transition ease-out duration-300"
                  x-transition:enter-start="opacity-0 transform scale-95"
                  x-transition:enter-end="opacity-100 transform scale-100"
                  x-transition:leave="transition ease-in duration-200"
                  x-transition:leave-start="opacity-100 transform scale-100"
                  x-transition:leave-end="opacity-0 transform scale-95"
                  class="w-full max-w-sm p-4 bg-white rounded-xl shadow-md"
                >
                  <!-- Seekable progress bar -->
                  <div class="mb-2">
                    <div class="flex justify-between text-xs text-chocolate-600 mb-1">
                      <span x-text="formatTime(currentTime)"></span>
                      <span x-text="formatTime(duration)"></span>
                    </div>
                    
                    <!-- Seekable progress bar -->
                    <div 
                      class="h-2 bg-gray-200 rounded-full overflow-hidden relative cursor-pointer" 
                      @click="
                        const rect = $el.getBoundingClientRect();
                        const pos = (event.clientX - rect.left) / rect.width;
                        currentTime = duration * pos;
                        $refs.birthdayMessage.currentTime = currentTime;
                      "
                    >
                      <div 
                        class="h-2 bg-primary-500 rounded-full"
                        :style="`width: ${duration ? (currentTime / duration) * 100 : 0}%`"
                      ></div>
                      
                      <!-- Draggable handle -->
                      <div 
                        class="absolute top-1/2 -translate-y-1/2 h-4 w-4 bg-primary-600 rounded-full shadow-md transform -translate-x-1/2 hover:scale-110 transition-transform"
                        :style="`left: ${duration ? (currentTime / duration) * 100 : 0}%`"
                        @mousedown="dragSeek($event)"
                      ></div>
                    </div>
                  </div>
                  
                  <!-- Volume control -->
                  <div class="flex items-center mt-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-chocolate-600" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10c0-1.105-.894-2.103-2.343-2.828a1 1 0 010-1.415z" clip-rule="evenodd" />
                    </svg>
                    <input 
                      type="range" 
                      min="0" 
                      max="1" 
                      step="0.05" 
                      x-model="volume"
                      @input="$refs.birthdayMessage.volume = volume; $refs.birthdaySong.volume = volume;"
                      class="w-full mx-2 accent-primary-500"
                    />
                    <span class="text-xs text-chocolate-600" x-text="Math.round(volume * 100) + '%'"></span>
                  </div>
                </div>
              
                <!-- Audio elements -->
                <audio x-ref="birthdaySong" src="bday.mp3" preload="auto"></audio>
                <audio x-ref="birthdayMessage" src="https://cdn.discordapp.com/attachments/1280909738841735169/1358466132914212945/lv_0_20250406233510.mp3?ex=67f3f1ad&is=67f2a02d&hm=2844327706b7d77288e67c7fd2f06e21512561dc739095523de84d0d63204a9e&" preload="auto"></audio>
              </div>
              
              <!-- Enhanced confetti container -->
              <div 
                x-show="blown" 
                x-transition 
                class="confetti-container fixed inset-0 pointer-events-none z-50"
              ></div>
            </div>
          </div>
          
          <!-- Decorative ribbon -->
          <div class="relative h-12 mt-10">
            <div class="absolute left-0 right-0 h-6 bg-gradient-to-r from-primary-300 to-primary-400 transform -skew-x-12 shadow-md"></div>
            <div class="absolute left-0 right-0 h-6 bg-gradient-to-r from-primary-400 to-primary-500 transform skew-x-12 top-6 shadow-md"></div>
          </div>
          
          <!-- Enhanced footer with author credit -->
          <div class="w-full text-center mt-8 mb-4">
            <div class="bg-white bg-opacity-70 backdrop-blur-sm rounded-full py-3 px-6 inline-block shadow-md">
              <p class="text-chocolate-800 text-sm font-medium">
                Made with <span class="text-red-500 animate-pulse inline-block transform hover:scale-125 transition-transform">❤️</span> by Agassi
              </p>
            </div>
          </div>
        </div>
      </div>
    
    </div>
  </div>
</body>
</html>